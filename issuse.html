<!DOCTYPE html>
<html>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.6, maximum-scale=1.5, user-scalable=no">
<head>
    
	<!-- <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script> -->
    <link href="bootstrap.min.css" rel="stylesheet">
    <script src="jquery.min.js"></script>
    <script src="bootstrap.min.js"></script>
    <script src="lodash.min.js"></script>
    <script src="commonmark.js"></script>
    <style>
        div.titlestyle {
            margin: auto;
            width: 99%;
            padding: 1%;
            text-align: center;
            color: rgb(79, 81, 86);
            border-radius: .45rem;
            border: 1px solid #dee2e6;
            box-shadow: 0 .325rem .55rem rgba(0,0,0,.275);
            background-color: #ffffff;
            font-size: 30px;
        }
    </style>
	<script>
        var reader = new commonmark.Parser();
        var writer = new commonmark.HtmlRenderer({ sourcepos: true });

        var render = function(parsed) {
            if (parsed === undefined) {
                return;
            }
            var startTime = new Date().getTime();
            var result = writer.render(parsed);
            document.getElementById("content").innerHTML=result;
        };
        var parseAndRender = function(text) {
            var parsed = reader.parse(text);
            render(parsed);
        };
        function getQueryVariable(variable)
        {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i=0;i<vars.length;i++) {
                    var pair = vars[i].split("=");
                    if(pair[0] == variable){return pair[1];}
            }
            return(false);
        }
        function showMarkdown(){
            var writer = new commonmark.HtmlRenderer({ sourcepos: true });
            var xmlhttp;
            xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange=function()
            {
                if (xmlhttp.readyState==4 && xmlhttp.status==200)
                {
                    var bb = JSON.parse(xmlhttp.responseText)
                    console.log(bb.body)
                    var title = document.getElementById("title")
                    title.className = "titlestyle"
                    title.textContent = bb.title
                    parseAndRender(bb.body)
                    loadMermaidOnNeed()
                }
            }
            xmlhttp.open("GET","https://api.github.com/repos/taontech/githublog/issues/"+getQueryVariable("iid"),true);
            xmlhttp.send();
        }
        showMarkdown()
    </script>

</head>
<body style="max-width: 1024px;margin: 0 auto;">
    <div id="title" padding="10px" margin="auto" > 
        <p>我的博客</p> 
    </div>
	<div class="container" style="margin-top:30px; max-width: 1024px;">
	<div id="content" ></div>
	</div> 
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" crossorigin="anonymous"></script>
</body>

<script>
    const loadScript = (url, onloadFunction) => {
      var newScript = document.createElement("script");
      newScript.onerror =  (oError) => {
        throw new URIError("The script " + oError.target.src + " didn't load correctly.");
      };
      if (onloadFunction) { newScript.onload = onloadFunction; }
      document.head.insertAdjacentElement('beforeend', newScript);
      newScript.src = url;
    }
  
    // mermaid loader by ttys3.dev
    const loadMermaidOnNeed = () => {
        loadScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js', () => {
          document.head.insertAdjacentHTML("beforeend", `<style>.mermaid svg { background-color: #ffffff !important; }</style>`);
          console.log("mermaid init done");
          mermaid.initialize({ startOnLoad: false, securityLevel: "strict", theme: "default" });
          window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid'));
        })
    }

    var gitalk = new Gitalk({
        id: 'githublog-2022-4-13-10-37',
        title: 'Add Gitalk Test',
        clientID: 'ce05afa47f84a85be6ad',
        clientSecret: '3dba78926e6ae22493a66851270dd2955c754b5f',
        repo: 'githublog',
        owner: 'taontech',
        admin: ['taontech'],
        body: decodeURI(location.href)
      });
      gitalk.render('gitalk-container');

    gitalk.render('gitalk-container')
  </script>
</html>
